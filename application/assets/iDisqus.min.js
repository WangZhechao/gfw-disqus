;(function( window ){
  'use strict';


  function GFWError(message) {
    this.name = 'GFWError';
    this.message = message || 'ajax error';
    this.stack = (new Error()).stack;
  }
  GFWError.prototype = Object.create(Error.prototype);
  GFWError.prototype.constructor = GFWError;


  function getAjax(url, cb) {
	  var xhr = null;  
	  if (window.XMLHttpRequest) {  
	      // 非IE内核  
	      xhr = new XMLHttpRequest();  
	  } else if (window.ActiveXObject) {  
	      // IE内核,这里早期IE的版本写法不同,具体可以查询下  
	      xhr = new ActiveXObject('Microsoft.XMLHTTP');  
	  } else {  
	      return cb && cb(new GFWError('xhr does not exist'));
	  }

	  xhr.timeout = 3000;
	  xhr.onerror = function(err) {
	  	return cb && cb(err);
	  }
      xhr.open('GET', encodeURI(url));  
      xhr.onreadystatechange = function () {  
          if (this.readyState == 4 && this.status == 200) {  
              return cb && cb(null, xhr.responseText);
          }
      };

      xhr.send();
  }


  function getPosts() {
  	getAjax('./listPosts?ident=ghost-5971becb4ab6c014a0b1f7c6', function(err, resp) {
  		if(err) {
  			console.log('获取评论列表出错！');
  			return;
  		}

  		var data = null;
  		try {
  			data = JSON.parse(resp);
  		} catch(e) {
  			data = null;
  		}

  		if(!data) {
  			console.log('解析json错误！');
  			return;
  		}


  		if(!data.success) {
  			console.log(data.errors[0].message);
  			return;
  		}


  		var _root = document.getElementById('comment');
  		_root.querySelector('#idisqus').classList.remove('loading');



  		console.log(data);
  	})
  }



  getPosts();
})(window);